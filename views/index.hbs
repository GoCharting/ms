<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Coinigy market scanner</title>

    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="row">
    <div class="col-lg-5 col-md-5 col-lg-offset-3 col-md-offset-3">
        <h1>Coinigy market scanner</h1>
    </div>
</div>
<div class="row">
    <div class="col-lg-5 col-md-5 col-lg-offset-3 col-md-offset-3">
            <p>Alert if currency price is below then lowest at the last:</p>
            <div class="btn-group filter-period-buttons" data-toggle="buttons">
                <label class="btn btn-default">
                    <input type="radio" name="filter-period" value="0">12 hours
                </label>
                <label class="btn btn-default">
                    <input type="radio" name="filter-period" value="1">day
                </label>
                <label class="btn btn-default">
                    <input type="radio" name="filter-period" value="2">2 days
                </label>
                <label class="btn btn-default">
                    <input type="radio" name="filter-period" value="3">3 days
                </label>
        </div>
    </div>
    <div class="col-lg-1 col-md-1">
        <button class="btn btn-default sound-button"><i class="fa fa-volume-up" aria-hidden="true"></i></button>
    </div>
</div>

<div class="col-lg-9 col-md-9 col-lg-offset-3 col-md-offset-3">
    <table class="table">

    </table>
</div>

<script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/bower_components/socket.io-client/dist/socket.io.slim.js"></script>
<script src="/bower_components/howler.js/dist/howler.min.js"></script>
<script>
    (function() {
        var window_focus = true;
        var alert_marker = '* ';
        var alerting = false;
        var play = true;
        var sound = new Howl({
            src: ['./sounds/zero_alert.mp3']
        });
        $('.sound-button').click(function(){
            if(play) {
                $('.sound-button i').addClass('fa-volume-off').removeClass('fa-volume-up');
            }
            else {
                $('.sound-button i').addClass('fa-volume-up').removeClass('fa-volume-off');
            }
            play = !play;
        });

        var socket = io.connect('http://localhost:3000');
        socket.on('alert', function (data) {
            console.log(data);
            if(!alerting && !window_focus) {
                document.title = alert_marker + document.title;
            }
            alerting = true;
            if(play) {
                sound.play();
            }
        });
        $(window).focus(function() {
            if(alerting) {
                document.title = document.title.replace(alert_marker, '');
                alerting = false;
            }
            window_focus = true;
        }).blur(function() {
            window_focus = false;
        });

        $('.filter-period-buttons input').change(function() {
            console.log($(this).val() + ' filter has chosen');
            socket.emit('choose_filter', {
                period: $(this).val()
            });
        });

    })();
</script>
</body>
</html>
